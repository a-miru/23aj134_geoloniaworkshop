<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Geolonia Maps Workshop – GeoJSON Marker</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Geolonia のスクリプト -->
  <script src="https://cdn.geolonia.com/v1/embed?geolonia-api-key=ec4ab98a033b4729ab4e90b46ae77bb5" defer></script>
</head>
<body>
  <h1>Geolonia Maps – Marker Workshop</h1>

  <!-- 基本の地図コンテナ -->
  <div
    class="geolonia"
    data-lat="34.342"
    data-lng="134.046"
    data-zoom="14"
    data-style="geolonia/basic"
    style="width:100%;height:60vh;"
  ></div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const el = document.querySelector('.geolonia');

    el.addEventListener('geolonia.load', async (e) => {
      const map = e.detail.map;

      // GeoJSON 複数マーカー読み込み
      const res = await fetch('./data.geojson'); // data.geojson が同ディレクトリに必要
      const geojson = await res.json();

      // 各点に Marker を置く
      for (const f of geojson.features) {
        const [lng, lat] = f.geometry.coordinates;
        const { name, desc } = f.properties;

        new maplibregl.Marker()
          .setLngLat([lng, lat])
          .setPopup(new maplibregl.Popup().setHTML(`<strong>${name}</strong><br>${desc ?? ''}`))
          .addTo(map);
      }

      // 地図を全マーカーにフィット
      const coords = geojson.features.map(f => f.geometry.coordinates);
      const bounds = coords.reduce(
        (b, c) => b.extend(c),
        new maplibregl.LngLatBounds(coords[0], coords[0])
      );
      map.fitBounds(bounds, { padding: 40, duration: 500 });
    });
  });
  </script>
</body>
</html>
