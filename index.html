<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Geolonia Maps Workshop</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Geolonia のスクリプト -->
  <script src="https://cdn.geolonia.com/v1/embed?geolonia-api-key=ec4ab98a033b4729ab4e90b46ae77bb5
" defer></script>
</head>
<body>
  <h1>Geolonia Maps – 課題提出版</h1>

  <!-- 基本の地図コンテナ -->
  <div
    class="geolonia"
    data-lat="34.342"   <!-- アイバル香川の緯度 -->
    data-lng="134.046"  <!-- アイバル香川の経度 -->
    data-zoom="14"
    data-style="geolonia/basic"
    style="width:100%;height:60vh;"
  ></div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const el = document.querySelector('.geolonia');

    el.addEventListener('geolonia.load', async (e) => {
      const map = e.detail.map;

      // =====================================================
      // Step1: 単一マーカー（課題①）
      // =====================================================
      /*
      new maplibregl.Marker()
        .setLngLat([134.046, 34.342]) // アイバル香川
        .setPopup(new maplibregl.Popup().setText('アイバル香川'))
        .addTo(map);
      */

      // =====================================================
      // Step2: GeoJSON 複数マーカー（今回は1件だけ）（課題②・③）
      // =====================================================
      const res = await fetch('./data.geojson');
      const geojson = await res.json();

      for (const f of geojson.features) {
        const [lng, lat] = f.geometry.coordinates;
        const { name, desc } = f.properties;

        new maplibregl.Marker()
          .setLngLat([lng, lat])
          .setPopup(new maplibregl.Popup().setHTML(`<strong>${name}</strong><br>${desc}`))
          .addTo(map);
      }

      // 1件だけでも fitBounds で中心に寄せる
      const coords = geojson.features.map(f => f.geometry.coordinates);
      const bounds = new maplibregl.LngLatBounds(coords[0], coords[0]);
      map.fitBounds(bounds, { padding: 40, duration: 500 });
    });
  });
  </script>
</body>
</html>
